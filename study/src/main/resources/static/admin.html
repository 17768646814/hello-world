<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>index.html</title>
    <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
</head>
<body ng-controller="WelcomeController" style="padding-top: 100px;">

<nav ng-scroll="70" class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
    <div class="container-fulid">
        <p class="navbar-text" style="margin-right: 50px;"><a href="index.html">首页</a></p>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <section>
                <table class="table table-bordered table-hover table-responsive" ng-page="log">
                    <thead>
                    <tr>
                        <th>时间</th>
                        <th>ip</th>
                        <th>url</th>
                        <th>名称</th>
                        <th>参数</th>
                        <th>描述</th>
                        <th>浏览器类型</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="tr in log.content">
                        <td>{{tr.cDate + ' ' +tr.cTime}}</td>
                        <td>{{tr.ip}}</td>
                        <td>{{tr.url}}</td>
                        <td>{{tr.name}}</td>
                        <td>{{tr.data}}</td>
                        <td>{{tr.des}}</td>
                        <td>{{tr.userAgent}}</td>
                    </tr>
                    </tbody>
                </table>
                <div page-foot="log"></div>
            </section>
        </div>
    </div>
</div>
<script src="//cdn.bootcss.com/angular.js/1.6.1/angular.min.js"></script>
<script>
    var sc = null;
    var app = angular.module('demo', [], function ($httpProvider) {
        $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
        $httpProvider.defaults.headers.put['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
        var param = function (obj) {
            var query = '', name, value, fullSubName, subName, subValue, innerObj, i;
            for (name in obj) {
                value = obj[name];
                if (value instanceof Array) {
                    for (i = 0; i < value.length; i++) {
                        subValue = value[i];
                        fullSubName = name + '[' + i + ']';
                        innerObj = {};
                        innerObj[fullSubName] = subValue;
                        query += param(innerObj) + '&';
                    }
                } else if (value instanceof Object) {
                    for (subName in value) {
                        subValue = value[subName];
                        fullSubName = name + '[' + subName + ']';
                        innerObj = {};
                        innerObj[fullSubName] = subValue;
                        query += param(innerObj) + '&';
                    }
                } else if (value !== undefined && value !== null) {
                    query += encodeURIComponent(name) + '=' + encodeURIComponent(value) + '&';
                }
            }
            return query.length ? query.substr(0, query.length - 1) : query;
        };
        $httpProvider.defaults.transformRequest = [function (data) {
            return angular.isObject(data) && String(data) !== '[object File]' ? param(data) : data;
        }];
    })
            .controller('WelcomeController', function ($scope, $http) {
                sc = $scope;
                $http.get('data/json/' + 'config' + '.json').then(function (data) {
                    sc.config = data.data;
                    sc['log'].url = sc.config.baseUrl + '/log/findAllPage';
                    sc['log'].findPage();
                }, null);
            })
            .directive('ngPage', function ($compile, $http) {
                return {
                    restrict: 'AC',
                    compile: function ngBindCompile(templateElement) {
                        $compile.$$addBindingClass(templateElement);
                        return function ngBindLink(scope, element, attr) {
                            var key = attr['ngPage'], config = {
                                "number": 0,
                                "size": 10,
                                "findPage": function (number) {
                                    if (number !== 0 && !number) {
                                        number = scope[key].number;
                                    } else if (number < 0) {
                                        number = 0;
                                    } else if (number >= scope[key].totalPages) {
                                        number = scope[key].totalPages - 1;
                                    }
                                    if (scope[key]['url']) {
                                        $http({
                                            method: 'POST',
                                            url: scope[key]['url'],
                                            data: {
                                                page: number,
                                                size: sc[key].size
                                            }
                                        }).then(callBack, null);
                                    }
                                }
                            };
                            scope[key] = angular.extend(config, scope[key]);
                            var callBack = (function (scope, attr) {
                                return function (data) {
                                    scope.$watch(attr['ngPage'], function ngBindWatchAction(value) {
                                        scope[key] = angular.extend(scope[key], data.data);
                                        scope[key].listPages = [];
                                        for (var i = 0; i < scope[key].totalPages; i++) {
                                            if (i - scope[key].number < 5 && scope[key].number - i < 5)
                                                scope[key].listPages.push(i);
                                        }
                                    });
                                }
                            })(scope, attr);
                            scope[key].findPage();
                        };
                    }
                };
            })
            .directive('pageFoot', function () {
                return {
                    restrict: 'AE',
                    scope: {
                        'page': '=pageFoot'
                    },
                    templateUrl: function (elem, attr) {
                        return 'common/page_foot.html';
                    }
                };
            })
            .directive('ngScroll', ['$window', function ($window) {
                return {
                    restrict: 'AC',
                    compile: function (ele, attr) {
                        $window = angular.element($window);
                        $window.on('scroll', function (event) {
                            if (attr['ngScroll'] < $window[0].scrollY) {
                                ele.css({display: 'none'});
                            } else {
                                ele.css({display: ''});
                            }
                        });
                    }
                };
            }]);
    angular.bootstrap(document, ['demo']);
</script>
</body>
</html>